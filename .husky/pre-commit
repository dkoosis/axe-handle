#!/bin/sh
# Path: .husky/pre-commit
# Pre-commit hook to validate code quality

# Exit on error
set -e

# Check if files are staged
if git diff --cached --quiet; then
  echo "No files staged for commit."
  exit 0
fi

# Only check files that are staged for commit
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.ts$|\.js$' || true)

if [ -z "$STAGED_FILES" ]; then
  echo "No TypeScript or JavaScript files staged for commit."
  exit 0
fi

# Validate path headers for staged files
for FILE in $STAGED_FILES; do
  node utils/validate-path-headers.js --file="$FILE" --fix
done

# Run ESLint on staged files
echo "Running ESLint on staged files..."
for FILE in $STAGED_FILES; do
  npx eslint --fix "$FILE"
done

# Add back the files that were fixed
for FILE in $STAGED_FILES; do
  git add "$FILE"
done

echo "Pre-commit validation successful!"